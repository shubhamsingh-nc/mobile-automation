appId: com.nymcard.masaar
tags:
  - auth
  - failure
  - login
---
#Load target app id from POM
- runFlow:
    label: Setting target platform app id
    commands:
      - runScript:
          file: ../../elements/targetApp.js
# Load element definitions from POM
- runFlow:
    label: Load element definitions
    commands:
      - runScript:
          file: ../../elements/login.js

# Initialize and launch application
- launchApp:
    appId: ${output.targetAppId}
    label: Launch app with clean state
    clearState: true

# Handle platform-specific onboarding
- runFlow:
    label: Dismiss Android 16KB warning dialog
    when:
      platform: android
    commands:
      - tapOn:
          text: OK
          optional: true

- runFlow:
    label: Navigate to login screen on iOS
    when:
      platform: ios
    commands:
      - tapOn:
          id: ${output.login.goToLoginButton}

# Enter phone number
- tapOn:
    label: Tap on phone number input field
    id: ${output.login.phoneNumberInput}

# Scroll to see full login form
- scroll:
    label: Scroll to see full login form

# Enter valid phone number
- inputText:
    label: Enter valid phone number
    text: "508635393"

- assertVisible:
    label: Verify login button is now enabled
    id: ${output.login.loginButton}
    enabled: true

# Submit phone number and navigate to OTP
- tapOn:
    label: Tap login button to request OTP
    id: ${output.login.loginButton}

# Verify OTP screen visible
- assertVisible:
    label: Verify OTP code field appears
    id: ${output.login.codeField}

# Tap on OTP into code field
- tapOn:
    label: Tap on OTP code field
    id: ${output.login.codeField}

# Enter valid otp in field
- inputText:
    label: Enter valid OTP code
    text: "0000"

# Enter Passcode into code field
- tapOn:
    label: Tap on Passcode field
    id: ${output.login.codeField}

# Enter an invalid passcode
- inputText:
    label: Enter an invalid passcode
    text: "112233"

# Hide keyboard
- hideKeyboard:
    label: Hide keyboard after passcode entry

# Verify continue button is enabled
- assertVisible:
    label: Verify continue button is enabled
    id: ${output.login.continueButton}
    enabled: true

# Enter an incorrect passcode and wait for error
- tapOn:
    label: Tap continue button to verify passcode
    id: ${output.login.continueButton}

# Skip for Trust device
- assertVisible:
    label: Verify secondary button appears on dashboard
    id: ${output.login.secondaryButton}

- tapOn:
    label: Tap secondary button to complete onboarding
    id: ${output.login.secondaryButton}

# Check for error notification
- assertVisible:
    text: "Invalid username or password"

# Capture platform-specific screenshots
- runFlow:
    label: Take Android success screenshot
    when:
      platform: android
    commands:
      - takeScreenshot: LoginFailureIncorrectPasscodeAndroid

- runFlow:
    label: Take iOS success screenshot
    when:
      platform: ios
    commands:
      - takeScreenshot: LoginFailureIncorrectPasscodeIOS
