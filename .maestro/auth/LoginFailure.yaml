appId: com.nymcard.masaar.dev
tags:
  - auth
  - failure
  - login
---
# Load element definitions from POM
- runFlow:
    label: Load element definitions
    commands:
      - runScript:
          file: ../elements/login.js

# Initialize and launch application
- launchApp:
    label: Launch app with clean state
    clearState: true

# Handle platform-specific onboarding
- runFlow:
    label: Dismiss Android permission dialog
    when:
      platform: android
    commands:
      - tapOn:
          text: OK
          optional: true

- runFlow:
    label: Navigate to login screen on iOS
    when:
      platform: ios
    commands:
      - tapOn:
          id: ${output.login.goToLoginButton}

# Verify initial state of login screen
- assertVisible:
    label: Verify phone number input is visible
    id: ${output.login.phoneNumberInput}

- assertVisible:
    label: Verify login button is visible and disabled
    id: ${output.login.loginButton}
    enabled: false

# Enter phone number
- tapOn:
    label: Tap on phone number input field
    id: ${output.login.phoneNumberInput}

- scroll:
    label: Scroll to see full login form

- inputText:
    label: Enter valid phone number
    text: '502562503'

- assertVisible:
    label: Verify login button is now enabled
    id: ${output.login.loginButton}
    enabled: true

# Submit phone number and navigate to OTP
- tapOn:
    label: Tap login button to request OTP
    id: ${output.login.loginButton}

- assertVisible:
    label: Verify OTP code field appears
    id: ${output.login.codeField}

# Enter and verify OTP input section
- tapOn:
    label: Tap on OTP code field
    id: ${output.login.codeField}

- assertVisible:
    label: Verify OTP input section is visible
    id: ${output.login.otpInputSection}

- assertNotVisible:
    label: Verify error OTP section is not visible initially
    id: ${output.login.errorOtpInputSection}

# Enter invalid OTP code
- inputText:
    label: Enter invalid OTP code to trigger error
    text: '1919'

# Verify error state
- assertNotVisible:
    label: Verify OTP input section is hidden after invalid entry
    id: ${output.login.otpInputSection}

- assertVisible:
    label: Verify error OTP section is now visible
    id: ${output.login.errorOtpInputSection}

# Capture platform-specific screenshots
- runFlow:
    label: Take Android failure screenshot
    when:
      platform: android
    commands:
      - takeScreenshot: LoginFailureAndroid

- runFlow:
    label: Take iOS failure screenshot
    when:
      platform: ios
    commands:
      - takeScreenshot: LoginFailureIOS
